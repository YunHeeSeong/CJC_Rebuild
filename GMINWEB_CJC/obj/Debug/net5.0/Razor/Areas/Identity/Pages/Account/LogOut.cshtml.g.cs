#pragma checksum "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\Account\LogOut.cshtml" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "b5487f49eb9a54bb73c2f9048d27f8df42a493c3"
// <auto-generated/>
#pragma warning disable 1591
[assembly: global::Microsoft.AspNetCore.Razor.Hosting.RazorCompiledItemAttribute(typeof(AspNetCore.Areas_Identity_Pages_Account_LogOut), @"mvc.1.0.razor-page", @"/Areas/Identity/Pages/Account/LogOut.cshtml")]
namespace AspNetCore
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Mvc;
    using Microsoft.AspNetCore.Mvc.Rendering;
    using Microsoft.AspNetCore.Mvc.ViewFeatures;
#nullable restore
#line 2 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\_ViewImports.cshtml"
using GMINWEB_Rebuild.Areas.Identity;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\_ViewImports.cshtml"
using GMINWEB_Rebuild.Areas.Identity.Pages;

#line default
#line hidden
#nullable disable
#nullable restore
#line 1 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\Account\_ViewImports.cshtml"
using GMINWEB_Rebuild.Areas.Identity.Pages.Account;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\Account\LogOut.cshtml"
using Microsoft.AspNetCore.Identity;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\Account\LogOut.cshtml"
using System.Net;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\Account\LogOut.cshtml"
using System.IO;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\Account\LogOut.cshtml"
using DataAccessLibrary;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\Account\LogOut.cshtml"
using DataAccessLibrary.Model;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\Account\LogOut.cshtml"
using System.Net.Sockets;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\Account\LogOut.cshtml"
using System.Threading;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\Account\LogOut.cshtml"
           [IgnoreAntiforgeryToken]

#line default
#line hidden
#nullable disable
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"b5487f49eb9a54bb73c2f9048d27f8df42a493c3", @"/Areas/Identity/Pages/Account/LogOut.cshtml")]
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"9e756528ddb62b41c609f2598e5160779becf879", @"/Areas/Identity/Pages/_ViewImports.cshtml")]
    [global::Microsoft.AspNetCore.Razor.Hosting.RazorSourceChecksumAttribute(@"SHA1", @"e7455a1d705ad37d6646a08c914968cbca33522d", @"/Areas/Identity/Pages/Account/_ViewImports.cshtml")]
    public class Areas_Identity_Pages_Account_LogOut : global::Microsoft.AspNetCore.Mvc.RazorPages.Page
    {
        #pragma warning disable 1998
        public async override global::System.Threading.Tasks.Task ExecuteAsync()
        {
            WriteLiteral("\r\n");
            WriteLiteral("\r\n");
        }
        #pragma warning restore 1998
#nullable restore
#line 13 "D:\작업장\Desktop\개발 솔루션\cjc관련 파일\CJCWEB_Rebuild\CJC\GMINWEB_CJC\Areas\Identity\Pages\Account\LogOut.cshtml"
            

    //public string loginId { get; set; }

    public async Task<IActionResult> OnPost()
    {

        if (SignInManager.IsSignedIn(User))
        {
            await SignInManager.SignOutAsync();

            Info(User.Identity.Name); //Principal => string 형태로 제공
        }

        return Redirect("~/");
    }

    public static string GetIp() //IpAddr 정보 받아오는 코드
    {

        IPHostEntry ipHost = Dns.GetHostEntry(Dns.GetHostName());
        string ip = String.Empty;
        for (int i = 0; i < ipHost.AddressList.Length; i++)
        {
            if (ipHost.AddressList[i].AddressFamily == AddressFamily.InterNetwork)
                ip = ipHost.AddressList[i].ToString();
        }
        return ip;
    }

    public static void Info(string ID)
    {

        try
        {
            //로그아웃 정보 로그기록 남기기
            //추후 로그 데이터를 모아 정해진 시점에 전송 고려
            string url = "https://log.smart-factory.kr/apisvc/sendLogDataXML.do";
            string prefix = "logData=";
            GlobalVar.IpAddr = GetIp(); //IP접속 주소 값
                                        //. = ID;// Login 시 입력한 Email(ID)값
            var data = "<logData>"; //로그기록전송 코드 (XML 형태)
            data += "<crtfcKey>" + System.Web.HttpUtility.UrlEncode("$5$API$s1rQDi4MOpTc2GIE5ZWQYRKIszkadhdUPfkgMUund9.") + "</crtfcKey>";
            data += "<logDt>" + System.Web.HttpUtility.UrlEncode(DateTime.Now.ToString("yyyy-MM-dd HH:MM:dd.fff")) + "</logDt>";
            data += "<useSe>" + System.Web.HttpUtility.UrlEncode("종료") + "</useSe>";
            data += "<sysUser>" + System.Web.HttpUtility.UrlEncode(ID) + "</sysUser>";
            data += "<conectIp>" + System.Web.HttpUtility.UrlEncode(GlobalVar.IpAddr) + "</conectIp>";
            data += "<dataUsgqty>" + System.Web.HttpUtility.UrlEncode("22222") + "</dataUsgqty>";
            data += "</logData>";

            //호출
            HttpWebRequest reque = (HttpWebRequest)WebRequest.Create(url);


            //urlencode
            string encodedt = System.Web.HttpUtility.UrlEncode(data);

            //byte로 변경
            byte[] reqInFormOfBytes = System.Text.Encoding.ASCII.GetBytes(prefix + encodedt);

            //속성설정
            reque.Method = "POST";
            reque.ContentType = "application/x-www-form-urlencoded";
            reque.ContentLength = reqInFormOfBytes.Length;
            reque.Timeout = 180000;

            //Thread.Sleep(180000);

            //stream 호출 및 전송
            System.IO.Stream reqStream = reque.GetRequestStream();
            reqStream.Write(reqInFormOfBytes, 0, reqInFormOfBytes.Length);
            reqStream.Close();

            /*응답 (응답 성공여부 확인 부분)
            result: OK
            Code: 200*/
            HttpWebResponse resp = (HttpWebResponse)reque.GetResponse();

            //streamReader 호출 및 문자열 처리
            StreamReader respStream = new StreamReader(resp.GetResponseStream(), System.Text.Encoding.Default);

            //확인용(전송결과) Code: AP1002 성공
            string receresp = respStream.ReadToEnd();
            //xmlReader 호출
            System.Xml.XmlReader reader = System.Xml.XmlReader.Create(new StringReader(receresp));
            respStream.Close();
            resp.Close();

        }
        catch (Exception e)
        {
            Console.WriteLine(e.Message);
        }
        finally
        {
            Console.WriteLine("성공");
        }
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public SignInManager<IdentityUser> SignInManager { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.ViewFeatures.IModelExpressionProvider ModelExpressionProvider { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IUrlHelper Url { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.IViewComponentHelper Component { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IJsonHelper Json { get; private set; }
        [global::Microsoft.AspNetCore.Mvc.Razor.Internal.RazorInjectAttribute]
        public global::Microsoft.AspNetCore.Mvc.Rendering.IHtmlHelper<Areas_Identity_Pages_Account_LogOut> Html { get; private set; }
        public global::Microsoft.AspNetCore.Mvc.ViewFeatures.ViewDataDictionary<Areas_Identity_Pages_Account_LogOut> ViewData => (global::Microsoft.AspNetCore.Mvc.ViewFeatures.ViewDataDictionary<Areas_Identity_Pages_Account_LogOut>)PageContext?.ViewData;
        public Areas_Identity_Pages_Account_LogOut Model => ViewData.Model;
    }
}
#pragma warning restore 1591
